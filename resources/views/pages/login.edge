<!DOCTYPE html>
<html lang="id">
<head>
  @vite('resources/css/comercial.css')
  <script src="https://cdn.tailwindcss.com"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Page</title>
</head>
<body class="bg-black">

  <div class="flex justify-center items-center h-screen">
    <div class="box-form p-8 rounded-2xl shadow-[0_0_20px_#47FF98] w-96">
      <h1 class="text-3xl font-semibold text-white text-center hover:text-green-600">Log In</h1>

      <form id="loginForm" class="mt-10">
        <input id="email" type="email"
               class="pb-[5px] mb-[40px] w-full text-white bg-transparent border-b outline-none"
               required placeholder="Your Email">

        <input id="password" type="password"
               class="pb-[5px] mb-[10px] w-full text-white bg-transparent border-b outline-none"
               required placeholder="Your Password">

        <div id="errorMessage" class="text-sm text-red-400 mt-2 hidden"></div>

        <button type="submit"
                class="mt-10 w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition duration-300">
          Log In
        </button>

        <a href="/register" class="block text-white text-center mt-4 hover:text-green-600">
          Don't have an account?
        </a>
      </form>
    </div>
  </div>

  @include('pages/partials/footer')

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("loginForm");
      const errorMessage = document.getElementById("errorMessage");

      // Jika sudah login, arahkan ke beranda
      const user = JSON.parse(localStorage.getItem("user"));
      if (user) {
        window.location.href = "/";
        return;
      }

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();

        // Cek login admin
        if (email === "admin@gmail.com" && password === "123") {
          localStorage.setItem("user", JSON.stringify({ email, role: "admin" }));
          alert("Login berhasil sebagai Admin!");
          window.location.href = "/seller";
          return;
        }

        // Ambil daftar user dari localStorage (hasil dari register)
        const users = JSON.parse(localStorage.getItem("users")) || [];

        // Cek apakah user terdaftar
        const validUser = users.find(u => u.email === email && u.password === password);

        if (validUser) {
          localStorage.setItem("user", JSON.stringify({ email, role: "buyer" }));
          alert("Login berhasil!");
          window.location.href = "/";
        } else {
          errorMessage.textContent = "Email atau password salah atau akun belum terdaftar!";
          errorMessage.classList.remove("hidden");
        }
      });
    });
  </script>
</body>
</html>
